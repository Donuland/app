/* ========================================
   DONULAND MANAGEMENT SYSTEM - PART 3A
   UI Display & Results Visualization
   ======================================== */

console.log('üç© Donuland Part 3A loading...');

// ========================================
// PREDICTION RESULTS DISPLAY
// ========================================

// Hlavn√≠ funkce pro zobrazen√≠ v√Ωsledk≈Ø predikce
function displayPredictionResults(predictionData) {
    console.log('üéØ Displaying prediction results...');
    
    const { formData, prediction, businessResults } = predictionData;
    const resultsDiv = document.getElementById('predictionResults');
    
    if (!resultsDiv) {
        console.error('‚ùå Results div not found');
        return;
    }
    
    try {
        // Generov√°n√≠ doporuƒçen√≠
        const recommendations = generateRecommendations(formData, prediction, businessResults);
        
        // Hlavn√≠ v√Ωsledky
        const mainResultsHtml = generateMainResults(prediction, businessResults);
        
        // Faktory breakdown
        const factorsHtml = generateFactorsBreakdown(prediction.factors);
        
        // Business breakdown
        const businessHtml = generateBusinessBreakdown(businessResults);
        
        // Doporuƒçen√≠
        const recommendationsHtml = generateRecommendationsHtml(recommendations);
        
        // Sestaven√≠ cel√©ho HTML
        const html = `
            <div class="prediction-results-container">
                ${mainResultsHtml}
                ${factorsHtml}
                ${businessHtml}
                ${recommendationsHtml}
            </div>
        `;
        
        resultsDiv.innerHTML = html;
        
        // Animace zobrazen√≠
        resultsDiv.classList.add('fade-in');
        
        // Zobrazen√≠ action buttons
        showActionButtons();
        
        console.log('‚úÖ Prediction results displayed successfully');
        
    } catch (error) {
        console.error('‚ùå Error displaying prediction results:', error);
        displayErrorResults(error.message);
    }
}

// Generov√°n√≠ hlavn√≠ch v√Ωsledk≈Ø
function generateMainResults(prediction, businessResults) {
    const sales = prediction.predictedSales;
    const confidence = prediction.confidence;
    const revenue = businessResults.revenue;
    const profit = businessResults.profit;
    const roi = businessResults.roi;
    const margin = businessResults.margin;
    
    // Urƒçen√≠ barvy podle ziskovosti
    let profitColor = '#28a745'; // Zelen√°
    let profitIcon = '‚úÖ';
    
    if (profit <= 0) {
        profitColor = '#dc3545'; // ƒåerven√°
        profitIcon = '‚ùå';
    } else if (profit < 1000) {
        profitColor = '#ffc107'; // ≈Ωlut√°
        profitIcon = '‚ö†Ô∏è';
    }
    
    // Urƒçen√≠ barvy podle confidence
    let confidenceColor = '#28a745';
    if (confidence < 60) confidenceColor = '#ffc107';
    if (confidence < 40) confidenceColor = '#dc3545';
    
    return `
        <div class="main-results">
            <h3>üéØ V√Ωsledky AI predikce</h3>
            
            <div class="results-grid">
                <div class="result-item primary">
                    <div class="result-icon">üç©</div>
                    <div class="result-value">${formatNumber(sales)}</div>
                    <div class="result-label">Predikovan√Ω prodej (ks)</div>
                </div>
                
                <div class="result-item">
                    <div class="result-icon">üéØ</div>
                    <div class="result-value" style="color: ${confidenceColor};">${confidence}%</div>
                    <div class="result-label">Confidence predikce</div>
                </div>
                
                <div class="result-item">
                    <div class="result-icon">üí∞</div>
                    <div class="result-value">${formatCurrency(revenue)}</div>
                    <div class="result-label">Oƒçek√°van√Ω obrat</div>
                </div>
                
                <div class="result-item">
                    <div class="result-icon">${profitIcon}</div>
                    <div class="result-value" style="color: ${profitColor};">${formatCurrency(profit)}</div>
                    <div class="result-label">Oƒçek√°van√Ω zisk</div>
                </div>
                
                <div class="result-item">
                    <div class="result-icon">üìà</div>
                    <div class="result-value" style="color: ${roi > 20 ? '#28a745' : roi > 0 ? '#ffc107' : '#dc3545'};">${roi.toFixed(1)}%</div>
                    <div class="result-label">ROI</div>
                </div>
                
                <div class="result-item">
                    <div class="result-icon">üìä</div>
                    <div class="result-value" style="color: ${margin > 30 ? '#28a745' : margin > 15 ? '#ffc107' : '#dc3545'};">${margin.toFixed(1)}%</div>
                    <div class="result-label">Mar≈æe</div>
                </div>
            </div>
        </div>
    `;
}

// Generov√°n√≠ breakdown faktor≈Ø
function generateFactorsBreakdown(factors) {
    return `
        <div class="factors-breakdown">
            <h4>üß† Rozklad AI faktor≈Ø</h4>
            <div class="factors-explanation">
                <p>Fin√°ln√≠ konverze: <strong>${(factors.final * 100).toFixed(2)}%</strong> n√°v≈°tƒõvn√≠k≈Ø koup√≠ donut</p>
            </div>
            
            <div class="factors-grid">
                <div class="factor-item">
                    <div class="factor-name">üìã Kategorie</div>
                    <div class="factor-value">${(factors.base * 100).toFixed(1)}%</div>
                    <div class="factor-bar">
                        <div class="factor-fill" style="width: ${factors.base * 100}%"></div>
                    </div>
                </div>
                
                <div class="factor-item">
                    <div class="factor-name">üìä Historick√© data</div>
                    <div class="factor-value">${(factors.historical * 100).toFixed(0)}%</div>
                    <div class="factor-bar">
                        <div class="factor-fill" style="width: ${Math.min(factors.historical * 50, 100)}%; background-color: ${factors.historical > 1 ? '#28a745' : factors.historical < 1 ? '#dc3545' : '#6c757d'}"></div>
                    </div>
                </div>
                
                <div class="factor-item">
                    <div class="factor-name">üèôÔ∏è Mƒõsto</div>
                    <div class="factor-value">${(factors.city * 100).toFixed(0)}%</div>
                    <div class="factor-bar">
                        <div class="factor-fill" style="width: ${Math.min(factors.city * 50, 100)}%; background-color: ${factors.city > 1 ? '#28a745' : factors.city < 1 ? '#dc3545' : '#6c757d'}"></div>
                    </div>
                </div>
                
                <div class="factor-item">
                    <div class="factor-name">üè™ Konkurence</div>
                    <div class="factor-value">${(factors.competition * 100).toFixed(0)}%</div>
                    <div class="factor-bar">
                        <div class="factor-fill" style="width: ${Math.min(factors.competition * 50, 100)}%; background-color: ${factors.competition > 1 ? '#28a745' : factors.competition < 1 ? '#dc3545' : '#6c757d'}"></div>
                    </div>
                </div>
                
                <div class="factor-item">
                    <div class="factor-name">üìÖ Sez√≥na</div>
                    <div class="factor-value">${(factors.seasonal * 100).toFixed(0)}%</div>
                    <div class="factor-bar">
                        <div class="factor-fill" style="width: ${Math.min(factors.seasonal * 50, 100)}%; background-color: ${factors.seasonal > 1 ? '#28a745' : factors.seasonal < 1 ? '#dc3545' : '#6c757d'}"></div>
                    </div>
                </div>
                
                <div class="factor-item">
                    <div class="factor-name">üë• Velikost akce</div>
                    <div class="factor-value">${(factors.size * 100).toFixed(0)}%</div>
                    <div class="factor-bar">
                        <div class="factor-fill" style="width: ${Math.min(factors.size * 50, 100)}%; background-color: ${factors.size > 1 ? '#28a745' : factors.size < 1 ? '#dc3545' : '#6c757d'}"></div>
                    </div>
                </div>
                
                <div class="factor-item">
                    <div class="factor-name">üå§Ô∏è Poƒças√≠</div>
                    <div class="factor-value">${(factors.weather * 100).toFixed(0)}%</div>
                    <div class="factor-bar">
                        <div class="factor-fill" style="width: ${Math.min(factors.weather * 50, 100)}%; background-color: ${factors.weather > 1 ? '#28a745' : factors.weather < 1 ? '#dc3545' : '#6c757d'}"></div>
                    </div>
                </div>
                
                <div class="factor-item">
                    <div class="factor-name">‚è∞ D√©lka akce</div>
                    <div class="factor-value">${(factors.duration * 100).toFixed(0)}%</div>
                    <div class="factor-bar">
                        <div class="factor-fill" style="width: ${Math.min(factors.duration * 50, 100)}%; background-color: ${factors.duration > 1 ? '#28a745' : factors.duration < 1 ? '#dc3545' : '#6c757d'}"></div>
                    </div>
                </div>
            </div>
            
            <div class="factors-note">
                <small>üí° Faktory >100% zvy≈°uj√≠ prodej, <100% sni≈æuj√≠. Zelen√° = pozitivn√≠, ƒçerven√° = negativn√≠ vliv.</small>
            </div>
        </div>
    `;
}

// Generov√°n√≠ business breakdown
function generateBusinessBreakdown(businessResults) {
    const { revenue, costs, totalCosts, profit, breakeven, metadata } = businessResults;
    
    return `
        <div class="business-breakdown">
            <h4>üíº Finanƒçn√≠ anal√Ωza</h4>
            
            <div class="business-summary">
                <div class="business-metric">
                    <span class="metric-label">Break-even point:</span>
                    <span class="metric-value">${formatNumber(breakeven)} ks</span>
                </div>
                <div class="business-metric">
                    <span class="metric-label">Business model:</span>
                    <span class="metric-value">${getBusinessModelLabel(metadata.businessModel)}</span>
                </div>
                <div class="business-metric">
                    <span class="metric-label">Cena za kus:</span>
                    <span class="metric-value">${formatCurrency(metadata.pricePerUnit)}</span>
                </div>
            </div>
            
            <div class="costs-breakdown">
                <h5>üìä Rozpis n√°klad≈Ø</h5>
                <div class="costs-grid">
                    <div class="cost-item">
                        <div class="cost-icon">üç©</div>
                        <div class="cost-details">
                            <div class="cost-name">V√Ωroba</div>
                            <div class="cost-value">${formatCurrency(costs.production)}</div>
                        </div>
                    </div>
                    
                    <div class="cost-item">
                        <div class="cost-icon">üë®‚Äçüíº</div>
                        <div class="cost-details">
                            <div class="cost-name">Mzdy</div>
                            <div class="cost-value">${formatCurrency(costs.labor)}</div>
                        </div>
                    </div>
                    
                    <div class="cost-item">
                        <div class="cost-icon">üöó</div>
                        <div class="cost-details">
                            <div class="cost-name">Doprava</div>
                            <div class="cost-value">${formatCurrency(costs.transport)}</div>
                        </div>
                    </div>
                    
                    <div class="cost-item">
                        <div class="cost-icon">üè¢</div>
                        <div class="cost-details">
                            <div class="cost-name">N√°jem</div>
                            <div class="cost-value">${formatCurrency(costs.rent)}</div>
                        </div>
                    </div>
                    
                    ${costs.revenueShare > 0 ? `
                    <div class="cost-item">
                        <div class="cost-icon">üìä</div>
                        <div class="cost-details">
                            <div class="cost-name">% z obratu</div>
                            <div class="cost-value">${formatCurrency(costs.revenueShare)}</div>
                        </div>
                    </div>
                    ` : ''}
                </div>
                
                <div class="costs-total">
                    <div class="total-row revenue">
                        <span>üí∞ Celkov√Ω obrat:</span>
                        <span>${formatCurrency(revenue)}</span>
                    </div>
                    <div class="total-row costs">
                        <span>üí∏ Celkov√© n√°klady:</span>
                        <span>${formatCurrency(totalCosts)}</span>
                    </div>
                    <div class="total-row profit ${profit > 0 ? 'positive' : 'negative'}">
                        <span><strong>${profit > 0 ? '‚úÖ' : '‚ùå'} ƒåist√Ω zisk:</strong></span>
                        <span><strong>${formatCurrency(profit)}</strong></span>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Generov√°n√≠ doporuƒçen√≠ HTML
function generateRecommendationsHtml(recommendations) {
    if (!recommendations || recommendations.length === 0) {
        return `
            <div class="recommendations">
                <h4>üí° Doporuƒçen√≠</h4>
                <div class="recommendation-item success">
                    <div class="recommendation-icon">‚úÖ</div>
                    <div class="recommendation-content">
                        <div class="recommendation-title">V√Ωborn√© podm√≠nky</div>
                        <div class="recommendation-text">V≈°echny faktory jsou optim√°ln√≠ pro √∫spƒõ≈°nou akci!</div>
                    </div>
                </div>
            </div>
        `;
    }
    
    const recommendationsHtml = recommendations.map(rec => `
        <div class="recommendation-item ${rec.type}">
            <div class="recommendation-icon">${rec.icon}</div>
            <div class="recommendation-content">
                <div class="recommendation-title">${rec.title}</div>
                <div class="recommendation-text">${rec.text}</div>
            </div>
        </div>
    `).join('');
    
    return `
        <div class="recommendations">
            <h4>üí° Doporuƒçen√≠ pro √∫spƒõ≈°nou akci</h4>
            ${recommendationsHtml}
        </div>
    `;
}

// ========================================
// ERROR HANDLING
// ========================================

// Zobrazen√≠ chyby p≈ôi predikci
function displayErrorResults(errorMessage) {
    const resultsDiv = document.getElementById('predictionResults');
    if (!resultsDiv) return;
    
    resultsDiv.innerHTML = `
        <div class="prediction-error">
            <div class="error-icon">‚ùå</div>
            <h4>Chyba p≈ôi v√Ωpoƒçtu predikce</h4>
            <p>${escapeHtml(errorMessage)}</p>
            <button class="btn btn-retry" onclick="retryPrediction()">üîÑ Zkusit znovu</button>
        </div>
    `;
}

// Retry predikce
function retryPrediction() {
    console.log('üîÑ Retrying prediction...');
    
    const validation = validateRequiredFields();
    if (validation.valid) {
        updatePrediction();
    } else {
        showNotification('‚ùå Opravte chyby ve formul√°≈ôi p≈ôed opakov√°n√≠m', 'error');
    }
}

// ========================================
// ACTION BUTTONS
// ========================================

// Zobrazen√≠ action buttons
function showActionButtons() {
    const actionButtons = document.getElementById('actionButtons');
    if (actionButtons) {
        actionButtons.style.display = 'flex';
        actionButtons.classList.add('fade-in');
    }
}

// Skryt√≠ action buttons
function hideActionButtons() {
    const actionButtons = document.getElementById('actionButtons');
    if (actionButtons) {
        actionButtons.style.display = 'none';
    }
}

// ========================================
// UTILITY FUNCTIONS
// ========================================

// Z√≠sk√°n√≠ labelu pro business model
function getBusinessModelLabel(businessModel) {
    const labels = {
        'owner': 'üè™ Majitel',
        'employee': 'üë®‚Äçüíº Zamƒõstnanec',
        'franchise': 'ü§ù Fran≈°√≠za'
    };
    
    return labels[businessModel] || businessModel;
}

// ========================================
// PLACEHOLDER DISPLAY
// ========================================

// Zobrazen√≠ placeholder p≈ôi naƒçten√≠
function displayPredictionPlaceholder() {
    const resultsDiv = document.getElementById('predictionResults');
    if (!resultsDiv) return;
    
    resultsDiv.innerHTML = `
        <div class="prediction-placeholder">
            <div class="placeholder-icon">ü§ñ</div>
            <h4>P≈ôipraveno k anal√Ωze</h4>
            <p>Vypl≈àte v≈°echna povinn√° pole oznaƒçen√° * pro spu≈°tƒõn√≠ AI predikce prodeje</p>
            <div class="required-fields-list">
                <div class="field-status" id="status-eventName">üìù N√°zev akce</div>
                <div class="field-status" id="status-category">üìã Kategorie</div>
                <div class="field-status" id="status-city">üèôÔ∏è Mƒõsto</div>
                <div class="field-status" id="status-dates">üìÖ Datum akce</div>
                <div class="field-status" id="status-visitors">üë• N√°v≈°tƒõvnost</div>
                <div class="field-status" id="status-competition">üè™ Konkurence</div>
                <div class="field-status" id="status-eventType">üè¢ Typ akce</div>
                <div class="field-status" id="status-businessModel">üíº Business model</div>
                <div class="field-status" id="status-rentType">üí∞ Typ n√°jmu</div>
            </div>
        </div>
    `;
}

// Aktualizace statusu pol√≠ v placeholder
function updateFieldsStatus() {
    const formData = gatherFormData();
    
    const fields = [
        { id: 'status-eventName', condition: formData.eventName && formData.eventName.trim() },
        { id: 'status-category', condition: formData.category },
        { id: 'status-city', condition: formData.city && formData.city.trim() },
        { id: 'status-dates', condition: formData.eventDateFrom && formData.eventDateTo },
        { id: 'status-visitors', condition: formData.visitors > 0 },
        { id: 'status-competition', condition: formData.competition },
        { id: 'status-eventType', condition: formData.eventType },
        { id: 'status-businessModel', condition: formData.businessModel },
        { id: 'status-rentType', condition: formData.rentType }
    ];
    
    fields.forEach(field => {
        const element = document.getElementById(field.id);
        if (element) {
            if (field.condition) {
                element.classList.add('completed');
                element.style.color = '#28a745';
                if (!element.textContent.includes('‚úÖ')) {
                    element.textContent = '‚úÖ ' + element.textContent.replace(/^[üìùüìãüèôÔ∏èüìÖüë•üè™üè¢üíºüí∞]\s/, '');
                }
            } else {
                element.classList.remove('completed');
                element.style.color = '#6c757d';
                element.textContent = element.textContent.replace('‚úÖ ', '');
            }
        }
    });
}

// ========================================
// LOADING STATES
// ========================================

// Zobrazen√≠ loading stavu
function displayPredictionLoading() {
    const resultsDiv = document.getElementById('predictionResults');
    if (!resultsDiv) return;
    
    resultsDiv.innerHTML = `
        <div class="prediction-loading">
            <div class="loading-spinner">
                <div class="spinner"></div>
            </div>
            <h4>ü§ñ AI poƒç√≠t√° predikci...</h4>
            <p>Analyzuji historick√° data, poƒças√≠ a v≈°echny faktory</p>
            <div class="loading-steps">
                <div class="loading-step active">üìä Naƒç√≠t√°m historick√° data</div>
                <div class="loading-step">üå§Ô∏è Analyzuji poƒças√≠</div>
                <div class="loading-step">üß† Poƒç√≠t√°m AI faktory</div>
                <div class="loading-step">üíº Kalkuluji business metriky</div>
                <div class="loading-step">üéØ Finalizuji predikci</div>
            </div>
        </div>
    `;
    
    // Animace krok≈Ø
    animateLoadingSteps();
}

// Animace loading krok≈Ø
function animateLoadingSteps() {
    const steps = document.querySelectorAll('.loading-step');
    let currentStep = 0;
    
    const interval = setInterval(() => {
        if (currentStep < steps.length) {
            steps[currentStep].classList.add('active');
            if (currentStep > 0) {
                steps[currentStep - 1].classList.remove('active');
                steps[currentStep - 1].classList.add('completed');
            }
            currentStep++;
        } else {
            clearInterval(interval);
        }
    }, 500);
}

// ========================================
// EVENT LISTENERS PRO PART 3A
// ========================================

// Event listener pro vypoƒç√≠tanou predikci
eventBus.on('predictionCalculated', (predictionData) => {
    console.log('üéØ Prediction calculated, displaying results');
    displayPredictionResults(predictionData);
});

// Event listener pro zmƒõnu formul√°≈ôe
eventBus.on('formChanged', (formData) => {
    // Aktualizace placeholder statusu
    updateFieldsStatus();
    
    // Pokud formul√°≈ô nen√≠ validn√≠, zobrazit placeholder
    const validation = validateRequiredFields();
    if (!validation.valid) {
        displayPredictionPlaceholder();
        hideActionButtons();
    }
});

// Event listener pro zaƒç√°tek prediction loading
eventBus.on('predictionStarted', () => {
    console.log('ü§ñ Prediction started, showing loading');
    displayPredictionLoading();
    hideActionButtons();
});

// Event listener pro chybu predikce
eventBus.on('predictionError', (error) => {
    console.log('‚ùå Prediction error, showing error message');
    displayErrorResults(error.message || 'Nezn√°m√° chyba p≈ôi v√Ωpoƒçtu predikce');
    hideActionButtons();
});

// ========================================
// INICIALIZACE PART 3A
// ========================================

// Inicializace p≈ôi naƒçten√≠ str√°nky
document.addEventListener('DOMContentLoaded', function() {
    console.log('üé® Initializing Part 3A UI...');
    
    // Zobrazen√≠ placeholder na zaƒç√°tku
    displayPredictionPlaceholder();
    
    // Skryt√≠ action buttons na zaƒç√°tku
    hideActionButtons();
    
    console.log('‚úÖ Part 3A UI initialized');
});

// ========================================
// FINALIZACE PART 3A
// ========================================

console.log('‚úÖ Donuland Part 3A loaded successfully');
console.log('üé® Features: ‚úÖ Results Display ‚úÖ Factors Breakdown ‚úÖ Business Analysis ‚úÖ Recommendations');
console.log('üéØ UI States: Placeholder ‚Üí Loading ‚Üí Results/Error');
console.log('üí° Interactive: Field status tracking + Action buttons');
console.log('‚è≥ Ready for Part 3B: Form Enhancements & Validation');

// Event pro signalizaci dokonƒçen√≠ ƒç√°sti 3A
eventBus.emit('part3aLoaded', { 
    timestamp: Date.now(),
    version: '1.0.0',
    features: ['results-display', 'factors-breakdown', 'business-analysis', 'recommendations-display', 'loading-states', 'error-handling']
});
/* ========================================
   DONULAND MANAGEMENT SYSTEM - PART 3B
   Form Enhancements & Advanced Validation
   ======================================== */

console.log('üç© Donuland Part 3B loading...');

// ========================================
// ENHANCED FORM VALIDATION
// ========================================

// Vylep≈°en√° validace formul√°≈ôe (oprava chyby validateForm)
function validateRequiredFields() {
    console.log('üîç Validating form fields...');
    
    const requiredFields = [
        { id: 'eventName', name: 'N√°zev akce', minLength: 3 },
        { id: 'category', name: 'Kategorie' },
        { id: 'city', name: 'Mƒõsto/Lokalita', minLength: 2 },
        { id: 'eventDateFrom', name: 'Datum od' },
        { id: 'eventDateTo', name: 'Datum do' },
        { id: 'visitors', name: 'N√°v≈°tƒõvnost', min: 50, max: 100000 },
        { id: 'competition', name: 'Konkurence' },
        { id: 'eventType', name: 'Typ akce' },
        { id: 'businessModel', name: 'Business model' },
        { id: 'rentType', name: 'Typ n√°jmu' }
    ];
    
    let allValid = true;
    const errors = [];
    
    requiredFields.forEach(field => {
        const element = document.getElementById(field.id);
        const isValid = validateField(element, field);
        
        if (!isValid.valid) {
            allValid = false;
            errors.push(...isValid.errors);
            markFieldAsError(element, isValid.errors);
        } else {
            markFieldAsValid(element);
        }
    });
    
    // Speci√°ln√≠ validace
    const specialValidation = performSpecialValidation();
    if (!specialValidation.valid) {
        allValid = false;
        errors.push(...specialValidation.errors);
    }
    
    // Update global validation state
    globalState.formValid = allValid;
    
    return { valid: allValid, errors: errors };
}

// Validace jednotliv√©ho pole
function validateField(element, fieldConfig) {
    if (!element) {
        return { valid: false, errors: [`Pole ${fieldConfig.name} nebylo nalezeno`] };
    }
    
    const value = element.value.trim();
    const errors = [];
    
    // Z√°kladn√≠ povinnost
    if (!value) {
        errors.push(`${fieldConfig.name} je povinn√© pole`);
        return { valid: false, errors };
    }
    
    // Minim√°ln√≠ d√©lka pro textov√° pole
    if (fieldConfig.minLength && value.length < fieldConfig.minLength) {
        errors.push(`${fieldConfig.name} mus√≠ m√≠t alespo≈à ${fieldConfig.minLength} znak≈Ø`);
    }
    
    // ƒå√≠seln√© rozsahy
    if (fieldConfig.min !== undefined || fieldConfig.max !== undefined) {
        const numValue = parseFloat(value);
        
        if (isNaN(numValue)) {
            errors.push(`${fieldConfig.name} mus√≠ b√Ωt ƒç√≠slo`);
        } else {
            if (fieldConfig.min !== undefined && numValue < fieldConfig.min) {
                errors.push(`${fieldConfig.name} mus√≠ b√Ωt alespo≈à ${fieldConfig.min}`);
            }
            if (fieldConfig.max !== undefined && numValue > fieldConfig.max) {
                errors.push(`${fieldConfig.name} nesm√≠ b√Ωt v√≠ce ne≈æ ${fieldConfig.max}`);
            }
        }
    }
    
    return { valid: errors.length === 0, errors };
}

// Speci√°ln√≠ validace (datumy, business logika)
function performSpecialValidation() {
    const errors = [];
    
    // Validace datum≈Ø
    const dateFrom = document.getElementById('eventDateFrom').value;
    const dateTo = document.getElementById('eventDateTo').value;
    
    if (dateFrom && dateTo) {
        const dateFromObj = new Date(dateFrom);
        const dateToObj = new Date(dateTo);
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        // Datum do mus√≠ b√Ωt >= datum od
        if (dateToObj < dateFromObj) {
            errors.push('Datum do nesm√≠ b√Ωt d≈ô√≠ve ne≈æ datum od');
            markFieldAsError(document.getElementById('eventDateTo'), ['Neplatn√© datum']);
        }
        
        // Varov√°n√≠ pro p≈ô√≠li≈° vzd√°len√© budouc√≠ akce
        const maxFutureDate = new Date();
        maxFutureDate.setFullYear(maxFutureDate.getFullYear() + 1);
        
        if (dateFromObj > maxFutureDate) {
            errors.push('Akce je p≈ô√≠li≈° daleko v budoucnosti (max 1 rok)');
        }
        
        // Varov√°n√≠ pro akce v minulosti
        if (dateFromObj < today) {
            // Nen√≠ chyba, ale upozornƒõn√≠
            showNotification('‚ö†Ô∏è Akce je napl√°nov√°na v minulosti', 'warning', 3000);
        }
    }
    
    // Validace business logiky
    const businessModel = document.getElementById('businessModel').value;
    const rentType = document.getElementById('rentType').value;
    
    // Specifick√© validace podle rent type
    if (rentType === 'fixed') {
        const fixedRent = parseFloat(document.getElementById('fixedRent')?.value || 0);
        if (fixedRent <= 0) {
            errors.push('Fixn√≠ n√°jem mus√≠ b√Ωt vy≈°≈°√≠ ne≈æ 0 Kƒç');
            markFieldAsError(document.getElementById('fixedRent'), ['Neplatn√° hodnota']);
        }
    }
    
    if (rentType === 'percentage') {
        const percentage = parseFloat(document.getElementById('percentage')?.value || 0);
        if (percentage <= 0 || percentage > 50) {
            errors.push('Procenta z obratu mus√≠ b√Ωt mezi 1-50%');
            markFieldAsError(document.getElementById('percentage'), ['Neplatn√° hodnota']);
        }
    }
    
    if (rentType === 'mixed') {
        const mixedFixed = parseFloat(document.getElementById('mixedFixed')?.value || 0);
        const mixedPercentage = parseFloat(document.getElementById('mixedPercentage')?.value || 0);
        
        if (mixedFixed <= 0 && mixedPercentage <= 0) {
            errors.push('Kombinovan√Ω n√°jem mus√≠ m√≠t alespo≈à jednu hodnotu > 0');
        }
    }
    
    // Validace ceny
    const price = parseFloat(document.getElementById('price')?.value || 0);
    if (price < 30 || price > 100) {
        errors.push('Cena donut by mƒõla b√Ωt mezi 30-100 Kƒç');
        markFieldAsError(document.getElementById('price'), ['Neobvykl√° cena']);
    }
    
    return { valid: errors.length === 0, errors };
}

// Oznaƒçen√≠ pole jako chybn√©
function markFieldAsError(element, errors) {
    if (!element) return;
    
    element.classList.add('error');
    element.setAttribute('title', errors.join(', '));
    
    // P≈ôid√°n√≠ chybov√© zpr√°vy
    let errorDiv = element.parentElement.querySelector('.field-error');
    if (!errorDiv) {
        errorDiv = document.createElement('div');
        errorDiv.className = 'field-error';
        element.parentElement.appendChild(errorDiv);
    }
    
    errorDiv.innerHTML = `
        <span class="error-icon">‚ö†Ô∏è</span>
        <span class="error-text">${errors[0]}</span>
    `;
    errorDiv.style.display = 'block';
}

// Oznaƒçen√≠ pole jako validn√≠
function markFieldAsValid(element) {
    if (!element) return;
    
    element.classList.remove('error');
    element.classList.add('valid');
    element.removeAttribute('title');
    
    // Odstranƒõn√≠ chybov√© zpr√°vy
    const errorDiv = element.parentElement.querySelector('.field-error');
    if (errorDiv) {
        errorDiv.style.display = 'none';
    }
    
    // P≈ôid√°n√≠ success ikony (doƒçasnƒõ)
    element.style.backgroundImage = 'url("data:image/svg+xml;charset=utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 8 8\'><path fill=\'%2328a745\' d=\'M2.3 6.73L.6 4.53c-.4-1.04.46-1.4 1.1-.8l1.1 1.4 3.4-3.8c.6-.63 1.6-.27 1.2.7l-4 4.6c-.43.5-.8.4-1.1.1z\'/></svg>")';
    element.style.backgroundRepeat = 'no-repeat';
    element.style.backgroundPosition = 'right 10px center';
    element.style.backgroundSize = '16px';
    
    // Odstranƒõn√≠ ikony po 2 sekund√°ch
    setTimeout(() => {
        element.style.backgroundImage = '';
    }, 2000);
}

// ========================================
// REAL-TIME FORM VALIDATION
// ========================================

// Nastaven√≠ real-time validace
function setupRealTimeValidation() {
    console.log('‚ö° Setting up real-time validation...');
    
    const formElements = document.querySelectorAll('input, select, textarea');
    
    formElements.forEach(element => {
        // Debounced validation p≈ôi psan√≠
        const debouncedValidation = debounce(() => {
            validateSingleField(element);
            updatePredictionTrigger();
        }, 300);
        
        // Event listeners
        element.addEventListener('input', debouncedValidation);
        element.addEventListener('change', () => {
            validateSingleField(element);
            updatePredictionTrigger();
        });
        
        element.addEventListener('blur', () => {
            validateSingleField(element);
        });
        
        element.addEventListener('focus', () => {
            // Odstranƒõn√≠ error styling p≈ôi focusu
            element.classList.remove('error');
            const errorDiv = element.parentElement.querySelector('.field-error');
            if (errorDiv) {
                errorDiv.style.display = 'none';
            }
        });
    });
    
    console.log('‚úÖ Real-time validation setup complete');
}

// Validace jednoho pole
function validateSingleField(element) {
    if (!element || !element.id) return;
    
    // Naj√≠t konfiguraci pole
    const fieldConfigs = {
        'eventName': { name: 'N√°zev akce', minLength: 3 },
        'category': { name: 'Kategorie' },
        'city': { name: 'Mƒõsto/Lokalita', minLength: 2 },
        'eventDateFrom': { name: 'Datum od' },
        'eventDateTo': { name: 'Datum do' },
        'visitors': { name: 'N√°v≈°tƒõvnost', min: 50, max: 100000 },
        'competition': { name: 'Konkurence' },
        'eventType': { name: 'Typ akce' },
        'businessModel': { name: 'Business model' },
        'rentType': { name: 'Typ n√°jmu' },
        'price': { name: 'Cena', min: 30, max: 100 }
    };
    
    const fieldConfig = fieldConfigs[element.id];
    if (!fieldConfig) return;
    
    const result = validateField(element, fieldConfig);
    
    if (result.valid) {
        markFieldAsValid(element);
    } else {
        markFieldAsError(element, result.errors);
    }
}

// ========================================
// SMART FORM SUGGESTIONS
// ========================================

// Inteligentn√≠ n√°vrhy p≈ôi psan√≠
function setupSmartSuggestions() {
    console.log('üß† Setting up smart suggestions...');
    
    // N√°vrhy pro mƒõsta na z√°kladƒõ historick√Ωch dat
    setupCitySuggestions();
    
    // N√°vrhy pro n√°zvy akc√≠
    setupEventNameSuggestions();
    
    // Auto-kategorization na z√°kladƒõ n√°zvu
    setupAutoCategorizationk();
    
    // Smart defaults
    setupSmartDefaults();
}

// N√°vrhy mƒõst z historick√Ωch dat
function setupCitySuggestions() {
    const cityInput = document.getElementById('city');
    if (!cityInput) return;
    
    cityInput.addEventListener('input', debounce(() => {
        const value = cityInput.value.toLowerCase().trim();
        if (value.length < 2) return;
        
        // Naj√≠t podobn√° mƒõsta v historick√Ωch datech
        const suggestions = globalState.historicalData
            .map(record => record.city)
            .filter(city => city && city.toLowerCase().includes(value))
            .filter((city, index, self) => self.indexOf(city) === index) // unique
            .slice(0, 5);
        
        if (suggestions.length > 0) {
            showCitySuggestions(cityInput, suggestions);
        }
    }, 300));
}

// Zobrazen√≠ n√°vrh≈Ø mƒõst
function showCitySuggestions(input, suggestions) {
    // Odstranƒõn√≠ star√Ωch n√°vrh≈Ø
    const existingSuggestions = document.querySelector('.city-suggestions');
    if (existingSuggestions) {
        existingSuggestions.remove();
    }
    
    // Vytvo≈ôen√≠ nov√Ωch n√°vrh≈Ø
    const suggestionsDiv = document.createElement('div');
    suggestionsDiv.className = 'city-suggestions';
    suggestionsDiv.innerHTML = suggestions.map(city => 
        `<div class="suggestion-item" onclick="selectCitySuggestion('${escapeHtml(city)}')">${escapeHtml(city)}</div>`
    ).join('');
    
    input.parentElement.appendChild(suggestionsDiv);
    
    // Auto-hide po 5 sekund√°ch
    setTimeout(() => {
        if (suggestionsDiv.parentElement) {
            suggestionsDiv.remove();
        }
    }, 5000);
}

// V√Ωbƒõr n√°vrhu mƒõsta
function selectCitySuggestion(city) {
    const cityInput = document.getElementById('city');
    if (cityInput) {
        cityInput.value = city;
        cityInput.dispatchEvent(new Event('change'));
        
        // Odstranƒõn√≠ n√°vrh≈Ø
        const suggestions = document.querySelector('.city-suggestions');
        if (suggestions) {
            suggestions.remove();
        }
    }
}

// Auto-kategorizace na z√°kladƒõ n√°zvu akce
function setupAutoCategorizationk() {
    const eventNameInput = document.getElementById('eventName');
    const categorySelect = document.getElementById('category');
    
    if (!eventNameInput || !categorySelect) return;
    
    eventNameInput.addEventListener('input', debounce(() => {
        const name = eventNameInput.value.toLowerCase();
        
        // U≈æ je kategorie vybran√°? Nep≈ôepisuj
        if (categorySelect.value) return;
        
        // Kl√≠ƒçov√° slova pro kategorie
        const categoryKeywords = {
            'food festival': ['food', 'fest', 'gastro', 'j√≠dlo', 'kulin√°≈ô', 'chu≈•', 'gurm√°n'],
            'veletrh': ['veletrh', 'v√Ωstava', 'trh', 'ƒçoko', 'chocolate', 'jarmark'],
            'koncert': ['koncert', 'hudba', 'festival', 'music', 'kapela', 'zpƒõv'],
            'kulturn√≠ akce': ['kultura', 'divadlo', 'muzeum', 'galerie', 'umƒõn√≠', 'v√Ωstava'],
            'sportovn√≠': ['sport', 'bƒõh', 'maraton', 'z√°vod', 'turnaj', 'poh√°r']
        };
        
        for (const [category, keywords] of Object.entries(categoryKeywords)) {
            if (keywords.some(keyword => name.includes(keyword))) {
                categorySelect.value = category;
                categorySelect.dispatchEvent(new Event('change'));
                
                // Notifikace o auto-v√Ωbƒõru
                showNotification(`ü§ñ Auto-vybr√°no: ${category}`, 'info', 2000);
                break;
            }
        }
    }, 500));
}

// Smart defaults na z√°kladƒõ kontextu
function setupSmartDefaults() {
    // Auto-nastaven√≠ datumu do = datum od pro jednodenn√≠ akce
    const dateFromInput = document.getElementById('eventDateFrom');
    const dateToInput = document.getElementById('eventDateTo');
    
    if (dateFromInput && dateToInput) {
        dateFromInput.addEventListener('change', () => {
            if (!dateToInput.value && dateFromInput.value) {
                dateToInput.value = dateFromInput.value;
                dateToInput.dispatchEvent(new Event('change'));
            }
        });
    }
    
    // Smart business model doporuƒçen√≠
    const visitorsInput = document.getElementById('visitors');
    const businessModelSelect = document.getElementById('businessModel');
    
    if (visitorsInput && businessModelSelect) {
        visitorsInput.addEventListener('change', debounce(() => {
            const visitors = parseInt(visitorsInput.value);
            
            if (!businessModelSelect.value && visitors > 0) {
                let recommendedModel = 'owner'; // default
                
                if (visitors < 1000) {
                    recommendedModel = 'franchise'; // Men≈°√≠ riziko pro mal√© akce
                } else if (visitors > 10000) {
                    recommendedModel = 'owner'; // Vy≈°≈°√≠ zisk pro velk√© akce
                } else {
                    recommendedModel = 'employee'; // St≈ôedn√≠ cesta
                }
                
                businessModelSelect.value = recommendedModel;
                businessModelSelect.dispatchEvent(new Event('change'));
                
                const modelNames = {
                    'owner': 'Majitel',
                    'employee': 'Zamƒõstnanec', 
                    'franchise': 'Fran≈°√≠za'
                };
                
                showNotification(`üí° Doporuƒçeno: ${modelNames[recommendedModel]} pro ${formatNumber(visitors)} n√°v≈°tƒõvn√≠k≈Ø`, 'info', 3000);
            }
        }, 1000));
    }
}

// ========================================
// FORM PROGRESS INDICATOR
// ========================================

// Ukazatel pokroku vypl≈àov√°n√≠ formul√°≈ôe
function updateFormProgress() {
    const requiredFields = [
        'eventName', 'category', 'city', 'eventDateFrom', 'eventDateTo', 
        'visitors', 'competition', 'eventType', 'businessModel', 'rentType'
    ];
    
    let completedFields = 0;
    
    requiredFields.forEach(fieldId => {
        const element = document.getElementById(fieldId);
        if (element && element.value.trim()) {
            completedFields++;
        }
    });
    
    const progress = (completedFields / requiredFields.length) * 100;
    
    // Aktualizace progress baru (pokud existuje)
    const progressBar = document.querySelector('.form-progress-bar');
    if (progressBar) {
        progressBar.style.width = `${progress}%`;
    }
    
    const progressText = document.querySelector('.form-progress-text');
    if (progressText) {
        progressText.textContent = `${completedFields}/${requiredFields.length} pol√≠ vyplnƒõno`;
    }
    
    return { progress, completedFields, totalFields: requiredFields.length };
}

// ========================================
// FORM AUTO-SAVE
// ========================================

// Automatick√© ukl√°d√°n√≠ formul√°≈ôe do localStorage
function setupAutoSave() {
    console.log('üíæ Setting up auto-save...');
    
    const formElements = document.querySelectorAll('input, select, textarea');
    
    const debouncedSave = debounce(() => {
        saveFormToLocalStorage();
    }, 2000);
    
    formElements.forEach(element => {
        element.addEventListener('input', debouncedSave);
        element.addEventListener('change', debouncedSave);
    });
    
    // Naƒçten√≠ p≈ôi startu
    loadFormFromLocalStorage();
}

// Ulo≈æen√≠ formul√°≈ôe do localStorage
function saveFormToLocalStorage() {
    try {
        const formData = gatherFormData();
        const saveData = {
            formData: formData,
            timestamp: Date.now(),
            url: window.location.href
        };
        
        localStorage.setItem('donuland_form_autosave', JSON.stringify(saveData));
        console.log('üíæ Form auto-saved');
        
    } catch (error) {
        console.error('‚ùå Auto-save failed:', error);
    }
}

// Naƒçten√≠ formul√°≈ôe z localStorage
function loadFormFromLocalStorage() {
    try {
        const saved = localStorage.getItem('donuland_form_autosave');
        if (!saved) return;
        
        const saveData = JSON.parse(saved);
        const age = Date.now() - saveData.timestamp;
        
        // Naƒç√≠st pouze pokud je mlad≈°√≠ ne≈æ 24 hodin
        if (age > 24 * 60 * 60 * 1000) {
            localStorage.removeItem('donuland_form_autosave');
            return;
        }
        
        const formData = saveData.formData;
        
        // Naƒçten√≠ dat do formul√°≈ôe (pouze pokud jsou pole pr√°zdn√°)
        Object.keys(formData).forEach(key => {
            const element = document.getElementById(key);
            if (element && !element.value && formData[key]) {
                element.value = formData[key];
            }
        });
        
        console.log('üì• Form data restored from auto-save');
        showNotification('üì• Formul√°≈ô obnovem z auto-save', 'info', 3000);
        
    } catch (error) {
        console.error('‚ùå Auto-load failed:', error);
        localStorage.removeItem('donuland_form_autosave');
    }
}

// ========================================
// PREDICTION TRIGGER OPTIMIZATION
// ========================================

// Optimalizovan√Ω trigger pro predikci
function updatePredictionTrigger() {
    // Debounced predikce - spust√≠ se a≈æ po dokonƒçen√≠ psan√≠
    if (globalState.predictionTimeout) {
        clearTimeout(globalState.predictionTimeout);
    }
    
    globalState.predictionTimeout = setTimeout(() => {
        const validation = validateRequiredFields();
        
        if (validation.valid) {
            // Emit event pro predikci
            eventBus.emit('formValidAndReady');
            
            // Pokud nejsou spu≈°tƒõny jin√© operace, spustit predikci
            if (!globalState.isLoadingPrediction && !globalState.isLoadingWeather) {
                eventBus.emit('triggerPrediction');
            }
        } else {
            // Form nen√≠ validn√≠, zobrazit placeholder
            eventBus.emit('formNotValid', validation.errors);
        }
        
        // Aktualizace progress
        updateFormProgress();
        
    }, 500); // 500ms delay
}

// ========================================
// EVENT LISTENERS PRO PART 3B
// ========================================

// Event listeners pro enhanced validation
eventBus.on('formValidAndReady', () => {
    console.log('‚úÖ Form is valid and ready for prediction');
    updateFieldsStatus();
});

eventBus.on('formNotValid', (errors) => {
    console.log('‚ùå Form validation failed:', errors);
    updateFieldsStatus();
    displayPredictionPlaceholder();
});

// Event pro zmƒõnu business modelu
eventBus.on('businessModelChanged', (data) => {
    updateBusinessInfo();
    validateRequiredFields();
});

// Event pro zmƒõnu rent type
eventBus.on('rentTypeChanged', (data) => {
    updateRentFields();
    validateRequiredFields();
});

// Event pro zmƒõnu event type
eventBus.on('eventTypeChanged', (data) => {
    updateWeatherCard();
    validateRequiredFields();
});

// ========================================
// INICIALIZACE PART 3B
// ========================================

// Inicializace p≈ôi naƒçten√≠ str√°nky
document.addEventListener('DOMContentLoaded', function() {
    console.log('üìù Initializing Part 3B Form Enhancements...');
    
    // Nastaven√≠ enhanced validation
    setupRealTimeValidation();
    
    // Nastaven√≠ smart suggestions
    setupSmartSuggestions();
    
    // Nastaven√≠ auto-save
    setupAutoSave();
    
    // Prvn√≠ validace
    setTimeout(() => {
        validateRequiredFields();
        updateFormProgress();
    }, 1000);
    
    console.log('‚úÖ Part 3B Form Enhancements initialized');
});

// ========================================
// FINALIZACE PART 3B
// ========================================

console.log('‚úÖ Donuland Part 3B loaded successfully');
console.log('üìù Features: ‚úÖ Enhanced Validation ‚úÖ Real-time Feedback ‚úÖ Smart Suggestions ‚úÖ Auto-save');
console.log('üß† Smart features: Auto-categorization + City suggestions + Smart defaults');
console.log('‚ö° Real-time: Field validation + Progress tracking + Debounced prediction trigger');
console.log('‚è≥ Ready for Part 3C: Advanced UI Components');

// Event pro signalizaci dokonƒçen√≠ ƒç√°sti 3B
eventBus.emit('part3bLoaded', { 
    timestamp: Date.now(),
    version: '1.0.0',
    features: ['enhanced-validation', 'real-time-feedback', 'smart-suggestions', 'auto-save', 'progress-tracking']
});
/* ========================================
   DONULAND MANAGEMENT SYSTEM - PART 3C
   Advanced UI Components & Interactions
   ======================================== */

console.log('üç© Donuland Part 3C loading...');

// ========================================
// ADVANCED TOOLTIPS & HELP SYSTEM
// ========================================

// Inteligentn√≠ tooltip syst√©m
function setupAdvancedTooltips() {
    console.log('üí° Setting up advanced tooltips...');
    
    const tooltipData = {
        'eventName': {
            title: 'N√°zev akce',
            content: 'Zadejte p≈ôesn√Ω n√°zev akce. Syst√©m automaticky vyhled√° podobn√© akce v historii.',
            examples: ['Burger Fest Praha', 'ƒåokoFest Brno', 'Food Festival Ostrava']
        },
        'category': {
            title: 'Kategorie akce',
            content: 'Kategorie ovliv≈àuje z√°kladn√≠ konverzn√≠ pomƒõr. Food festivaly maj√≠ nejwy≈°≈°√≠ konverzi.',
            stats: {
                'food festival': '15% konverze',
                'veletrh': '18% konverze (nejlep≈°√≠)',
                'koncert': '8% konverze (nejhor≈°√≠)'
            }
        },
        'visitors': {
            title: 'Oƒçek√°van√° n√°v≈°tƒõvnost',
            content: 'Celkov√Ω poƒçet n√°v≈°tƒõvn√≠k≈Ø za celou dobu akce. Vƒõt≈°√≠ akce maj√≠ vy≈°≈°√≠ konverzi.',
            formula: 'Predikovan√Ω prodej = N√°v≈°tƒõvnost √ó Konverzn√≠ faktory'
        },
        'competition': {
            title: '√örove≈à konkurence',
            content: 'Poƒçet podobn√Ωch food st√°nk≈Ø na akci.',
            impact: {
                1: '+20% prodej (mal√° konkurence)',
                2: 'Baseline (st≈ôedn√≠ konkurence)', 
                3: '-30% prodej (velk√° konkurence)'
            }
        },
        'price': {
            title: 'Prodejn√≠ cena donut',
            content: 'Optim√°ln√≠ cena je 45-55 Kƒç. Vy≈°≈°√≠ cena = vy≈°≈°√≠ mar≈æe, ale ni≈æ≈°√≠ prodej.',
            recommendation: 'Doporuƒçeno: 50 Kƒç'
        }
    };
    
    // Vytvo≈ôen√≠ tooltip element≈Ø
    Object.keys(tooltipData).forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
            setupFieldTooltip(field, tooltipData[fieldId]);
        }
    });
}

// Nastaven√≠ tooltip pro konkr√©tn√≠ pole
function setupFieldTooltip(field, data) {
    const container = field.parentElement;
    
    // P≈ôid√°n√≠ help ikony
    const helpIcon = document.createElement('div');
    helpIcon.className = 'field-help-icon';
    helpIcon.innerHTML = '‚ùì';
    helpIcon.title = 'Kliknƒõte pro n√°povƒõdu';
    
    container.style.position = 'relative';
    container.appendChild(helpIcon);
    
    // Event listeners
    helpIcon.addEventListener('click', (e) => {
        e.stopPropagation();
        showAdvancedTooltip(helpIcon, data, field.id);
    });
    
    // Hover effect
    helpIcon.addEventListener('mouseenter', () => {
        helpIcon.style.transform = 'scale(1.2)';
    });
    
    helpIcon.addEventListener('mouseleave', () => {
        helpIcon.style.transform = 'scale(1)';
    });
}

// Zobrazen√≠ pokroƒçil√©ho tooltip
function showAdvancedTooltip(trigger, data, fieldId) {
    // Odstranƒõn√≠ existuj√≠c√≠ho tooltip
    const existing = document.querySelector('.advanced-tooltip');
    if (existing) {
        existing.remove();
    }
    
    // Vytvo≈ôen√≠ tooltip
    const tooltip = document.createElement('div');
    tooltip.className = 'advanced-tooltip';
    
    let content = `
        <div class="tooltip-header">
            <h4>${data.title}</h4>
            <button class="tooltip-close" onclick="closeAdvancedTooltip()">√ó</button>
        </div>
        <div class="tooltip-content">
            <p>${data.content}</p>
    `;
    
    // P≈ôid√°n√≠ p≈ô√≠klad≈Ø
    if (data.examples) {
        content += `
            <div class="tooltip-examples">
                <strong>P≈ô√≠klady:</strong>
                <ul>
                    ${data.examples.map(ex => `<li>${ex}</li>`).join('')}
                </ul>
            </div>
        `;
    }
    
    // P≈ôid√°n√≠ statistik
    if (data.stats) {
        content += `
            <div class="tooltip-stats">
                <strong>Konverzn√≠ pomƒõry:</strong>
                <ul>
                    ${Object.entries(data.stats).map(([key, value]) => 
                        `<li><span class="stat-category">${key}:</span> <span class="stat-value">${value}</span></li>`
                    ).join('')}
                </ul>
            </div>
        `;
    }
    
    // P≈ôid√°n√≠ dopad≈Ø
    if (data.impact) {
        content += `
            <div class="tooltip-impact">
                <strong>Vliv na prodej:</strong>
                <ul>
                    ${Object.entries(data.impact).map(([key, value]) => 
                        `<li><span class="impact-level">${key}:</span> <span class="impact-value">${value}</span></li>`
                    ).join('')}
                </ul>
            </div>
        `;
    }
    
    // P≈ôid√°n√≠ formule
    if (data.formula) {
        content += `
            <div class="tooltip-formula">
                <strong>V√Ωpoƒçet:</strong>
                <code>${data.formula}</code>
            </div>
        `;
    }
    
    // P≈ôid√°n√≠ doporuƒçen√≠
    if (data.recommendation) {
        content += `
            <div class="tooltip-recommendation">
                <strong>üí° ${data.recommendation}</strong>
            </div>
        `;
    }
    
    content += '</div>';
    tooltip.innerHTML = content;
    
    // Pozicov√°n√≠
    document.body.appendChild(tooltip);
    positionTooltip(tooltip, trigger);
    
    // Animace
    tooltip.style.opacity = '0';
    tooltip.style.transform = 'scale(0.8)';
    
    requestAnimationFrame(() => {
        tooltip.style.opacity = '1';
        tooltip.style.transform = 'scale(1)';
    });
    
    // Auto-close po 10 sekund√°ch
    setTimeout(() => {
        closeAdvancedTooltip();
    }, 10000);
}

// Pozicov√°n√≠ tooltip
function positionTooltip(tooltip, trigger) {
    const triggerRect = trigger.getBoundingClientRect();
    const tooltipRect = tooltip.getBoundingClientRect();
    
    let left = triggerRect.left + window.scrollX;
    let top = triggerRect.bottom + window.scrollY + 10;
    
    // Kontrola p≈ôekroƒçen√≠ okraje
    if (left + tooltipRect.width > window.innerWidth) {
        left = window.innerWidth - tooltipRect.width - 20;
    }
    
    if (top + tooltipRect.height > window.innerHeight + window.scrollY) {
        top = triggerRect.top + window.scrollY - tooltipRect.height - 10;
    }
    
    tooltip.style.left = `${left}px`;
    tooltip.style.top = `${top}px`;
}

// Zav≈ôen√≠ tooltip
function closeAdvancedTooltip() {
    const tooltip = document.querySelector('.advanced-tooltip');
    if (tooltip) {
        tooltip.style.opacity = '0';
        tooltip.style.transform = 'scale(0.8)';
        setTimeout(() => {
            if (tooltip.parentElement) {
                tooltip.remove();
            }
        }, 200);
    }
}

// ========================================
// FORM PROGRESS VISUALIZATION
// ========================================

// Vytvo≈ôen√≠ progress baru
function createFormProgressBar() {
    const header = document.querySelector('.section-header');
    if (!header) return;
    
    const progressContainer = document.createElement('div');
    progressContainer.className = 'form-progress-container';
    progressContainer.innerHTML = `
        <div class="form-progress-wrapper">
            <div class="form-progress-label">
                <span class="form-progress-text">0/10 pol√≠ vyplnƒõno</span>
                <span class="form-progress-percentage">0%</span>
            </div>
            <div class="form-progress-track">
                <div class="form-progress-bar"></div>
            </div>
            <div class="form-progress-steps">
                <div class="progress-step" data-step="basic">üìã Z√°kladn√≠ √∫daje</div>
                <div class="progress-step" data-step="details">üéØ Detaily akce</div>
                <div class="progress-step" data-step="business">üíº Business model</div>
                <div class="progress-step" data-step="costs">üí∞ N√°klady</div>
                <div class="progress-step" data-step="ready">üéâ P≈ôipraveno</div>
            </div>
        </div>
    `;
    
    header.appendChild(progressContainer);
    
    // Inicializace progress tracking
    updateFormProgressAdvanced();
}

// Pokroƒçil√© sledov√°n√≠ progress
function updateFormProgressAdvanced() {
    const steps = {
        'basic': ['eventName', 'category', 'city'],
        'details': ['eventDateFrom', 'eventDateTo', 'visitors', 'competition'],
        'business': ['eventType', 'businessModel'],
        'costs': ['rentType', 'price'],
        'ready': [] // Speci√°ln√≠ krok pro dokonƒçen√≠
    };
    
    let totalFields = 0;
    let completedFields = 0;
    let currentStep = 'basic';
    
    // V√Ωpoƒçet pokroku podle krok≈Ø
    Object.entries(steps).forEach(([stepName, fields]) => {
        totalFields += fields.length;
        
        let stepCompleted = 0;
        fields.forEach(fieldId => {
            const element = document.getElementById(fieldId);
            if (element && element.value.trim()) {
                completedFields++;
                stepCompleted++;
            }
        });
        
        // Aktualizace UI kroku
        const stepElement = document.querySelector(`[data-step="${stepName}"]`);
        if (stepElement) {
            if (stepCompleted === fields.length && fields.length > 0) {
                stepElement.classList.add('completed');
                stepElement.classList.remove('active');
                currentStep = getNextStep(stepName);
            } else if (stepCompleted > 0) {
                stepElement.classList.add('active');
                stepElement.classList.remove('completed');
                currentStep = stepName;
            } else {
                stepElement.classList.remove('active', 'completed');
            }
        }
    });
    
    // Speci√°ln√≠ kontrola pro "ready" krok
    const validation = validateRequiredFields();
    const readyStep = document.querySelector('[data-step="ready"]');
    if (readyStep) {
        if (validation.valid) {
            readyStep.classList.add('completed');
            readyStep.classList.remove('active');
        } else {
            readyStep.classList.remove('completed');
            if (completedFields >= totalFields * 0.8) {
                readyStep.classList.add('active');
            }
        }
    }
    
    // Aktualizace progress baru
    const progress = totalFields > 0 ? (completedFields / totalFields) * 100 : 0;
    
    const progressBar = document.querySelector('.form-progress-bar');
    const progressText = document.querySelector('.form-progress-text');
    const progressPercentage = document.querySelector('.form-progress-percentage');
    
    if (progressBar) {
        progressBar.style.width = `${progress}%`;
    }
    
    if (progressText) {
        progressText.textContent = `${completedFields}/${totalFields} pol√≠ vyplnƒõno`;
    }
    
    if (progressPercentage) {
        progressPercentage.textContent = `${Math.round(progress)}%`;
    }
    
    // Emit progress event
    eventBus.emit('formProgressChanged', {
        progress: progress,
        completedFields: completedFields,
        totalFields: totalFields,
        currentStep: currentStep,
        isValid: validation.valid
    });
    
    return { progress, completedFields, totalFields, currentStep };
}

// Z√≠sk√°n√≠ dal≈°√≠ho kroku
function getNextStep(currentStep) {
    const stepOrder = ['basic', 'details', 'business', 'costs', 'ready'];
    const currentIndex = stepOrder.indexOf(currentStep);
    return stepOrder[currentIndex + 1] || 'ready';
}

// ========================================
// FIELD HIGHLIGHTING & FOCUS MANAGEMENT
// ========================================

// Inteligentn√≠ highlighting pr√°zdn√Ωch pol√≠
function setupFieldHighlighting() {
    console.log('‚ú® Setting up field highlighting...');
    
    // Tlaƒç√≠tko pro highlight pr√°zdn√Ωch pol√≠
    addHighlightButton();
    
    // Auto-highlight p≈ôi pokusu o predikci s ne√∫pln√Ωm formul√°≈ôem
    eventBus.on('formNotValid', (errors) => {
        highlightEmptyRequiredFields();
    });
}

// P≈ôid√°n√≠ tlaƒç√≠tka pro highlight
function addHighlightButton() {
    const formHeader = document.querySelector('.card h3');
    if (!formHeader) return;
    
    const highlightBtn = document.createElement('button');
    highlightBtn.className = 'btn btn-highlight';
    highlightBtn.innerHTML = '‚ú® Oznaƒçit pr√°zdn√° pole';
    highlightBtn.onclick = highlightEmptyRequiredFields;
    
    formHeader.appendChild(highlightBtn);
}

// Oznaƒçen√≠ pr√°zdn√Ωch povinn√Ωch pol√≠
function highlightEmptyRequiredFields() {
    const requiredFields = [
        'eventName', 'category', 'city', 'eventDateFrom', 'eventDateTo', 
        'visitors', 'competition', 'eventType', 'businessModel', 'rentType'
    ];
    
    let firstEmptyField = null;
    
    requiredFields.forEach(fieldId => {
        const element = document.getElementById(fieldId);
        if (element) {
            if (!element.value.trim()) {
                // Oznaƒçen√≠ pr√°zdn√©ho pole
                element.classList.add('highlight-empty');
                element.style.animation = 'fieldPulse 2s ease-in-out';
                
                if (!firstEmptyField) {
                    firstEmptyField = element;
                }
                
                // Odstranƒõn√≠ highlight po 3 sekund√°ch
                setTimeout(() => {
                    element.classList.remove('highlight-empty');
                    element.style.animation = '';
                }, 3000);
            } else {
                // Oznaƒçen√≠ vyplnƒõn√©ho pole
                element.classList.add('highlight-filled');
                setTimeout(() => {
                    element.classList.remove('highlight-filled');
                }, 1000);
            }
        }
    });
    
    // Scroll a focus na prvn√≠ pr√°zdn√© pole
    if (firstEmptyField) {
        firstEmptyField.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'center' 
        });
        
        setTimeout(() => {
            firstEmptyField.focus();
        }, 500);
        
        showNotification(`üìç Skokem na prvn√≠ pr√°zdn√© pole: ${firstEmptyField.previousElementSibling?.textContent || 'Nezn√°m√© pole'}`, 'info', 3000);
    }
}

// ========================================
// SMART FORM NAVIGATION
// ========================================

// Inteligentn√≠ navigace mezi poli
function setupSmartNavigation() {
    console.log('üß≠ Setting up smart navigation...');
    
    const formElements = document.querySelectorAll('input, select, textarea');
    
    formElements.forEach((element, index) => {
        // Enter key navigation
        element.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && element.tagName !== 'TEXTAREA') {
                e.preventDefault();
                
                // Naj√≠t dal≈°√≠ nevyplnƒõn√© pole
                const nextField = findNextEmptyField(index, formElements);
                if (nextField) {
                    nextField.focus();
                    nextField.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                } else {
                    // V≈°echna pole vyplnƒõna, zkusit predikci
                    const validation = validateRequiredFields();
                    if (validation.valid) {
                        eventBus.emit('triggerPrediction');
                        showNotification('üéâ Formul√°≈ô kompletn√≠! Spou≈°t√≠m predikci...', 'success', 3000);
                    }
                }
            }
        });
        
        // Tab trap pro lep≈°√≠ UX
        element.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                // P≈ôidat visual feedback
                setTimeout(() => {
                    const focusedElement = document.activeElement;
                    if (focusedElement && focusedElement !== element) {
                        focusedElement.style.boxShadow = '0 0 10px rgba(102, 126, 234, 0.3)';
                        setTimeout(() => {
                            focusedElement.style.boxShadow = '';
                        }, 1000);
                    }
                }, 50);
            }
        });
    });
}

// Naj√≠t dal≈°√≠ pr√°zdn√© pole
function findNextEmptyField(currentIndex, allElements) {
    // Hled√°n√≠ dop≈ôedu
    for (let i = currentIndex + 1; i < allElements.length; i++) {
        const element = allElements[i];
        if (isRequiredField(element) && !element.value.trim()) {
            return element;
        }
    }
    
    // Hled√°n√≠ od zaƒç√°tku
    for (let i = 0; i < currentIndex; i++) {
        const element = allElements[i];
        if (isRequiredField(element) && !element.value.trim()) {
            return element;
        }
    }
    
    return null;
}

// Kontrola zda je pole povinn√©
function isRequiredField(element) {
    const requiredIds = [
        'eventName', 'category', 'city', 'eventDateFrom', 'eventDateTo', 
        'visitors', 'competition', 'eventType', 'businessModel', 'rentType'
    ];
    
    return requiredIds.includes(element.id);
}

// ========================================
// DYNAMIC FIELD INTERACTIONS
// ========================================

// Dynamick√© interakce mezi poli
function setupDynamicInteractions() {
    console.log('üîÑ Setting up dynamic interactions...');
    
    // Kategorie ovliv≈àuje doporuƒçen√© ceny
    setupCategoryPriceInteraction();
    
    // Velikost akce ovliv≈àuje doporuƒçen√≠
    setupVisitorsSizeInteraction();
    
    // Business model ovliv≈àuje rent suggestions
    setupBusinessRentInteraction();
    
    // Poƒças√≠ warnings pro outdoor akce
    setupWeatherWarnings();
}

// Interakce kategorie a ceny
function setupCategoryPriceInteraction() {
    const categorySelect = document.getElementById('category');
    const priceInput = document.getElementById('price');
    
    if (!categorySelect || !priceInput) return;
    
    const categoryPrices = {
        'food festival': { optimal: 55, range: '50-60 Kƒç', reason: 'N√°v≈°tƒõvn√≠ci oƒçek√°vaj√≠ kvalitu' },
        'veletrh': { optimal: 60, range: '55-65 Kƒç', reason: 'Vy≈°≈°√≠ kupn√≠ s√≠la n√°v≈°tƒõvn√≠k≈Ø' },
        'koncert': { optimal: 45, range: '40-50 Kƒç', reason: 'Mlad≈°√≠ publikum, cenovƒõ citliv√©' },
        'kulturn√≠ akce': { optimal: 50, range: '45-55 Kƒç', reason: 'St≈ôedn√≠ kupn√≠ s√≠la' },
        'sportovn√≠': { optimal: 48, range: '45-52 Kƒç', reason: 'Rychl√© obƒçerstven√≠ bƒõhem akce' }
    };
    
    categorySelect.addEventListener('change', () => {
        const category = categorySelect.value;
        const priceData = categoryPrices[category];
        
        if (priceData && (!priceInput.value || priceInput.value == CONFIG.DONUT_PRICE)) {
            priceInput.value = priceData.optimal;
            
            // Zobrazen√≠ doporuƒçen√≠
            showPriceRecommendation(priceInput, priceData);
        }
    });
}

// Zobrazen√≠ doporuƒçen√≠ ceny
function showPriceRecommendation(priceInput, priceData) {
    // Odstranƒõn√≠ star√©ho doporuƒçen√≠
    const existingRec = priceInput.parentElement.querySelector('.price-recommendation');
    if (existingRec) {
        existingRec.remove();
    }
    
    // Nov√© doporuƒçen√≠
    const recommendation = document.createElement('div');
    recommendation.className = 'price-recommendation';
    recommendation.innerHTML = `
        <div class="recommendation-content">
            <span class="rec-icon">üí°</span>
            <span class="rec-text">Doporuƒçeno: ${priceData.range}</span>
            <span class="rec-reason">${priceData.reason}</span>
        </div>
    `;
    
    priceInput.parentElement.appendChild(recommendation);
    
    // Auto-remove po 5 sekund√°ch
    setTimeout(() => {
        if (recommendation.parentElement) {
            recommendation.remove();
        }
    }, 5000);
}

// Interakce velikosti akce
function setupVisitorsSizeInteraction() {
    const visitorsInput = document.getElementById('visitors');
    if (!visitorsInput) return;
    
    visitorsInput.addEventListener('input', debounce(() => {
        const visitors = parseInt(visitorsInput.value);
        if (isNaN(visitors)) return;
        
        // Zobrazen√≠ kategorie velikosti
        showEventSizeCategory(visitorsInput, visitors);
        
        // Varov√°n√≠ pro extr√©mn√≠ velikosti
        if (visitors > 50000) {
            showNotification('‚ö†Ô∏è Velmi velk√° akce! Zva≈æte dodateƒçn√Ω person√°l a logistiku.', 'warning', 5000);
        } else if (visitors < 100) {
            showNotification('üí° Mal√° akce. Fran≈°√≠zov√Ω model m≈Ø≈æe b√Ωt vhodnƒõj≈°√≠.', 'info', 3000);
        }
    }, 1000));
}

// Zobrazen√≠ kategorie velikosti akce
function showEventSizeCategory(visitorsInput, visitors) {
    let category, description, color;
    
    if (visitors < 500) {
        category = 'Mal√° akce';
        description = 'Lok√°ln√≠ ud√°lost, ni≈æ≈°√≠ konverze';
        color = '#ffc107';
    } else if (visitors < 2000) {
        category = 'St≈ôedn√≠ akce';
        description = 'Region√°ln√≠ dosah, standardn√≠ konverze';
        color = '#28a745';
    } else if (visitors < 10000) {
        category = 'Velk√° akce';
        description = 'Vysok√Ω potenci√°l, vy≈°≈°√≠ konverze';
        color = '#17a2b8';
    } else {
        category = 'Mega akce';
        description = 'Extr√©mn√≠ potenci√°l, nejvy≈°≈°√≠ konverze';
        color = '#6f42c1';
    }
    
    // Odstranƒõn√≠ star√© kategorie
    const existingCategory = visitorsInput.parentElement.querySelector('.size-category');
    if (existingCategory) {
        existingCategory.remove();
    }
    
    // Nov√° kategorie
    const categoryDiv = document.createElement('div');
    categoryDiv.className = 'size-category';
    categoryDiv.innerHTML = `
        <span class="category-badge" style="background-color: ${color};">${category}</span>
        <span class="category-description">${description}</span>
    `;
    
    visitorsInput.parentElement.appendChild(categoryDiv);
}

// Business a rent interakce
function setupBusinessRentInteraction() {
    const businessSelect = document.getElementById('businessModel');
    const rentSelect = document.getElementById('rentType');
    
    if (!businessSelect || !rentSelect) return;
    
    businessSelect.addEventListener('change', () => {
        const businessModel = businessSelect.value;
        
        // Doporuƒçen√≠ rent type podle business modelu
        const recommendations = {
            'owner': 'mixed', // Kombinace pro vlastn√≠ka
            'employee': 'percentage', // Procenta pro zamƒõstnance
            'franchise': 'free' // ƒåasto zdarma pro fran≈°√≠zu
        };
        
        if (recommendations[businessModel] && !rentSelect.value) {
            rentSelect.value = recommendations[businessModel];
            rentSelect.dispatchEvent(new Event('change'));
            
            showNotification(`üí° Auto-vybr√°no: ${getRentTypeLabel(recommendations[businessModel])} pro ${getBusinessModelLabel(businessModel)}`, 'info', 3000);
        }
    });
}

// Z√≠sk√°n√≠ labelu pro rent type
function getRentTypeLabel(rentType) {
    const labels = {
        'fixed': 'Fixn√≠ n√°jem',
        'percentage': '% z obratu',
        'mixed': 'Kombinace',
        'free': 'Zdarma'
    };
    
    return labels[rentType] || rentType;
}

// ========================================
// QUICK ACTIONS & SHORTCUTS
// ========================================

// Rychl√© akce a zkratky
function setupQuickActions() {
    console.log('‚ö° Setting up quick actions...');
    
    // Tlaƒç√≠tko pro rychl√© vyplnƒõn√≠ demo dat
    addQuickFillButton();
    
    // Tlaƒç√≠tko pro reset formul√°≈ôe
    addResetButton();
    
    // Tlaƒç√≠tko pro kop√≠rov√°n√≠ posledn√≠ch √∫daj≈Ø
    addCopyLastButton();
    
    // Keyboard shortcuts
    setupKeyboardShortcuts();
}

// Tlaƒç√≠tko pro rychl√© vyplnƒõn√≠
function addQuickFillButton() {
    const formHeader = document.querySelector('.card h3');
    if (!formHeader) return;
    
    const quickFillBtn = document.createElement('button');
    quickFillBtn.className = 'btn btn-demo';
    quickFillBtn.innerHTML = 'üé≠ Demo data';
    quickFillBtn.onclick = fillDemoData;
    quickFillBtn.title = 'Rychle vyplnit demo data pro testov√°n√≠';
    
    formHeader.appendChild(quickFillBtn);
}

// Vyplnƒõn√≠ demo dat
function fillDemoData() {
    const demoData = {
        eventName: 'Burger Fest Praha',
        category: 'food festival',
        city: 'Praha',
        eventDateFrom: getDateInFuture(14),
        eventDateTo: getDateInFuture(16),
        visitors: '8000',
        competition: '2',
        eventType: 'outdoor',
        businessModel: 'owner',
        rentType: 'mixed',
        mixedFixed: '3000',
        mixedPercentage: '8',
        price: '55'
    };
    
    Object.entries(demoData).forEach(([key, value]) => {
        const element = document.getElementById(key);
        if (element) {
            element.value = value;
            element.dispatchEvent(new Event('change'));
        }
    });
    
    showNotification('üé≠ Demo data vyplnƒõna', 'success', 2000);
}

// Z√≠sk√°n√≠ data v budoucnosti
function getDateInFuture(days) {
    const date = new Date();
    date.setDate(date.getDate() + days);
    return date.toISOString().split('T')[0];
}

// Tlaƒç√≠tko pro reset
function addResetButton() {
    const formHeader = document.querySelector('.card h3');
    if (!formHeader) return;
    
    const resetBtn = document.createElement('button');
    resetBtn.className = 'btn btn-reset';
    resetBtn.innerHTML = 'üîÑ Reset';
    resetBtn.onclick = resetForm;
    resetBtn.title = 'Vymazat v≈°echna data formul√°≈ôe';
    
    formHeader.appendChild(resetBtn);
}

// Reset formul√°≈ôe
function resetForm() {
    if (confirm('Opravdu chcete vymazat v≈°echna data z formul√°≈ôe?')) {
        const formElements = document.querySelectorAll('input, select, textarea');
        
        formElements.forEach(element => {
            if (element.type === 'checkbox' || element.type === 'radio') {
                element.checked = false;
            } else {
                element.value = '';
            }
            
            // Reset styling
            element.classList.remove('error', 'valid');
        });
        
        // Reset business info cards
        updateBusinessInfo();
        updateRentFields();
        
        // Reset results
        displayPredictionPlaceholder();
        hideActionButtons();
        
        // Vymaz√°n√≠ auto-save
        localStorage.removeItem('donuland_form_autosave');
        
        showNotification('üîÑ Formul√°≈ô resetov√°n', 'info', 2000);
    }
}

// ========================================
// EVENT LISTENERS PRO PART 3C
// ========================================

// Event listeners pro advanced UI
eventBus.on('formProgressChanged', (data) => {
    console.log(`üìä Form progress: ${data.progress.toFixed(1)}% (${data.completedFields}/${data.totalFields})`);
    
    // Spou≈°tƒõn√≠ efekt≈Ø podle pokroku
    if (data.progress >= 100 && data.isValid) {
        // Animace dokonƒçen√≠
        celebrateFormCompletion();
    }
});

// Oslava dokonƒçen√≠ formul√°≈ôe
function celebrateFormCompletion() {
    // Jednor√°zov√° animace
    if (globalState.formCompletionCelebrated) return;
    globalState.formCompletionCelebrated = true;
    
    showNotification('üéâ Formul√°≈ô je kompletn√≠! P≈ôipravuji predikci...', 'success', 4000);
    
    // Scroll k v√Ωsledk≈Øm
    setTimeout(() => {
        const resultsSection = document.getElementById('predictionResults');
        if (resultsSection) {
            resultsSection.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }
    }, 1000);
}

// Event pro zav≈ôen√≠ tooltip p≈ôi kliknut√≠ mimo
document.addEventListener('click', (e) => {
    if (!e.target.closest('.advanced-tooltip') && !e.target.closest('.field-help-icon')) {
        closeAdvancedTooltip();
    }
});

// Event pro escape key
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeAdvancedTooltip();
    }
});

// ========================================
// INICIALIZACE PART 3C
// ========================================

// Inicializace p≈ôi naƒçten√≠ str√°nky
document.addEventListener('DOMContentLoaded', function() {
    console.log('üé® Initializing Part 3C Advanced UI...');
    
    // Vytvo≈ôen√≠ progress baru
    setTimeout(() => {
        createFormProgressBar();
    }, 500);
    
    // Nastaven√≠ tooltips
    setupAdvancedTooltips();
    
    // Nastaven√≠ field highlighting
    setupFieldHighlighting();
    
    // Nastaven√≠ smart navigation
    setupSmartNavigation();
    
    // Nastaven√≠ dynamic interactions
    setupDynamicInteractions();
    
    // Nastaven√≠ quick actions
    setupQuickActions();
    
    console.log('‚úÖ Part 3C Advanced UI initialized');
});

// ========================================
// FINALIZACE PART 3C
// ========================================

console.log('‚úÖ Donuland Part 3C loaded successfully');
console.log('üé® Features: ‚úÖ Advanced Tooltips ‚úÖ Progress Visualization ‚úÖ Smart Navigation ‚úÖ Dynamic Interactions');
console.log('‚ö° Quick Actions: Demo data + Reset + Copy last + Keyboard shortcuts');
console.log('‚ú® UX Enhancements: Field highlighting + Auto-recommendations + Smart defaults');
console.log('üéØ All Part 3 components ready - UI is now fully interactive!');

// Event pro signalizaci dokonƒçen√≠ ƒç√°sti 3C
eventBus.emit('part3cLoaded', { 
    timestamp: Date.now(),
    version: '1.0.0',
    features: ['advanced-tooltips', 'progress-visualization', 'smart-navigation', 'dynamic-interactions', 'quick-actions', 'field-highlighting']
});
